# Human Capture

Приложение для определения человека в кадре на Python 3.10.6.
При обнаружении человека в указанной области кадра, его изображение сохраняется в базу данных.

## Основной функционал

- Захват изображения с веб-камеры в реальном времени
- Обнаружение человека в определенной области кадра
- Сохранение изображений в бд
- Поддержка SSE для уведомлений о новых изображениях
- Эндпоинт для получения изображений по диапазону дат
- Веб-страница, отображающая фото в реальном времени

## Установка

### 1. Клонируйте репозиторий:

```bash
git clone https://github.com/a-melchikov/human-capture.git
cd human-capture
```

### 2. Установите зависимости ([uv - python package and project manager](https://docs.astral.sh/uv/)):

```bash
uv sync
```

### 3. Создайте файл настроек settings.json, есть пример в корне проекта

```json
{
  "x": 50,                     // Координата x верхнего левого угла для поиска человека
  "y": 50,                     // Координата y верхнего левого угла для поиска человека
  "width": 300,                // Ширина области
  "height": 400,               // Высота области
  "min_visible_points": 20,    // Минимальное количество видимых ключевых точек, чтобы считать человека обнаруженным (максимум 33)
  "visibility_threshold": 0.5, // Порог видимости ключевой точки (от 0 до 1)
  "save_path": "saved_photos"  // Путь к папке, куда сохраняются снимки с обнаруженными людьми
}
```

### 4. Запустите приложение:

```bash
uv run uvicorn app.main:app --reload --port 5000
```

## Технологии

- FastAPI: Основной фреймворк для построения API;
- Uvicorn: ASGI-сервер для запуска FastAPI;
- SQLAlchemy: ORM для работы с базой данных;
- OpenCV: Работа с изображениями и захват с веб-камеры;
- MediaPipe: Детекция человека в кадре;
- Alembic: Миграции для базы данных;
- Pydantic: Валидация и сериализация данных;
- Sqlite: База данных.

## Структура проекта

- migrations: Миграции Alembic;
- routers: Маршруты приложения;
- config.py: Загрузка и работа с настройками;
- dao.py: Data Access Object, логика доступа к данным;
- database.py: Подключение к базе данных и инициализация SQLAlchemy;
- detector.py: Обработка видео, детекция человека в кадре;
- exceptions.py: Исключения используемые в проекте;
- lifespan.py: Жизненного цикла приложения;
- main.py: Запуск FastAPI приложения;
- models.py: SQLAlchemy-модель Detection;
- schemas.py: Pydantic-схема DetectionOut.
